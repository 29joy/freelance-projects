1) 做成可点击的 exe 给非技术用户用 —— 必要, 且可行

方案: Python + Playwright → 用 PyInstaller 打包为单个 exe(或一个文件夹型分发)。首次运行若未检测到浏览器内核, 则提示一键下载(后台执行 python -m playwright install chromium 的等价逻辑)。

注意: Playwright 浏览器体积较大; 可做 离线包(提前打包浏览器), 或做 在线按需下载 两种分发模式。

体验: 用户启动 exe → 选择 Excel → 点击“开始” → 输出结果(CSV/Excel)与日志。

我们已有的验证脚本可以作为内核功能的起点(打开链接、关闭登录弹窗、进入评论、滚动抽取)。

test_playwright_douyin_v2

依赖清单(pandas、playwright)简洁明了, 易于复用。

requirements

2) Excel 只需一列 URL; 若 URL 为空则“按内容关键词搜索抖音并回填 URL”

必要性: 看客户需求。若客户承诺会补齐 URL, 就不做自动搜; 若客户不补齐, 你这功能非常加分(但要单列开价, 因为“找帖”本身很费时)。

推荐算法(轻量可行): 

从 Content 或 content_segmented 取关键词(中文分词后去停用词, 保留 6–12 个高频词/名词)。

访问 Douyin 搜索页, 拿前 3–5 个候选视频的标题/简介; 

用 相似度匹配(如 RapidFuzz: token_set_ratio / 加权关键词命中)选得分最高者, 分数 ≥ 85% 才回填 URL, 否则标记“未命中”。

风控: 给 exe 加一个“仅处理已有 URL / 允许自动搜索回填”的开关; 回填成功/失败都要写入 url_status 字段与日志。

3) 抓取内容的标准(点赞阈值 & 是否抓回复)

点赞阈值: 

不同视频热度差异巨大, 用固定 200 可能过严。建议 三选一可切换: 

Top-N 模式(默认): 每条 URL 抓取 前 200 条(或 300/500, 可配置)

阈值模式: 抓取 like_count ≥ T 的评论(T 默认 50 或 100; 200 作为高门槛选项)

混合模式: 先抓 Top-N, 再从剩余补充到 like≥T

这样既能保证有“代表性”的热门评论, 又避免冷视频颗粒过粗。

是否抓回复(层级): 

建议默认 抓 1 层回复(depth=1), 且绑定父评论; 

每个父评论最多抓前 5 条回复(可配置), 避免爆量; 

若任务强调“主流观点”, 也可以仅抓顶层评论, 不抓回复。

排序: 优先抓 最热(热门) 标签下的评论; 若客户需要, 也可支持 按时间 抓取最近 N 条。

4) 导出格式(CSV/Excel)与字段建议

推荐导出: 默认 CSV(通用、轻量), 可选 Excel(xlsx), 并生成 失败与空结果报告。

字段设计(推荐): 

url, platform, video_id

comment_id, parent_id, is_reply(0/1), reply_depth(0/1)

user_id, username, verified(0/1 可选)

text, like_count, publish_time(ISO), rank_tab(hot/all/chronological)

capture_ts(抓取时间戳), run_id(本次运行标识)

status(ok/empty/failed/login_required/blocked 等), notes(可选错误信息)

文件组织: 

汇总表: 所有 URL 的评论在一个 CSV(含 url 和 video_id 字段以区分); 

错误表: _failed_urls.csv(记录失败 URL、失败原因、重试次数); 

去重策略: (url, comment_id) 去重; 找不到稳定 id 时, (url, normalized_text, user_id) 近似去重。

我们现有的可行性脚本已能输出 CSV 样本, 便于快速对齐字段口径。

README_TEST

5) config / logging / retry / CLI 等

完全同意你“顺带实现”的想法, 但前提是 先把 1–4 的口径定死, 否则耦合度高、容易返工。

最终 exe 里也保留一份 config.yaml(或 config.json), 让阈值、上限、是否抓回复等都可改; 日志与失败重试列表输出到 logs/ 与 reports/。

还需要考虑的关键工程问题(容易被忽略)

等待与滚动

对评论抽屉面板做 容器内滚动(优于整页滚动); 

采用 条件等待: 如“直到当前已抓评论数在 1.5s 内不再增长”再结束; 

对“展开更多回复”“展开更多评论”按钮做循环点击(有次数上限), 避免无限刷。

我们的 v2 验证脚本已包含面板滚动与“展开”尝试, 但正式版要更精细的循环与超时判断。

test_playwright_douyin_v2

反爬与稳定性

节流与随机等待(避免固化间隔); 

并发度别太高(起步 2–4 线程即可), 并可在失败率升高时自动降并发; 

必要时支持 代理池(可配置), 但先用“低并发+节流+重试”争取不启用代理。

错误截图/源代码片段保存: 失败时将页面截图到 errors/, 方便复盘。

登录态/更高覆盖(可选能力)

当无登录抓不到足量热门/全部评论时, 支持导入 cookie(由客户提供测试账号), 提升覆盖率; 

登录态必须加 安全提示(本地仅明文存放在用户电脑、可随时清除)。

搜索回填的精准度度量

给每个自动回填 URL 写入 match_score 与 matched_title, 低于阈值标黄, 防止误配。

允许“仅输出已命中 / 输出命中+未命中报告”的两种模式。

法律与合规(简述提醒)

在 README 中加入“仅用于获授权的研究用途、遵守平台条款、请勿高频并发”的声明; 

增加 --polite 模式: 更低速抓取、夜间暂停选项(对学术方友好)。